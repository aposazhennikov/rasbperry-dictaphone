# Иерархическое меню с озвучкой для незрячих пользователей

Проект представляет собой иерархическое меню с навигацией с помощью клавиш (пульта) и озвучкой всех пунктов меню.

## Требования

Для работы проекта необходимы следующие зависимости:

```
evdev>=1.6.0  # для работы с пультом
gTTS>=2.3.1   # для озвучки текста (бесплатный синтез)
google-cloud-texttospeech>=2.14.1  # для работы с Google Cloud TTS (более качественный)
google-cloud-monitoring>=2.14.1  # для получения статистики использования API
```

Кроме того, проект использует следующие стандартные библиотеки Python:
- os, sys - для работы с файловой системой
- threading, subprocess - для многопоточности и запуска внешних процессов
- hashlib, json - для хеширования и работы с JSON
- datetime - для работы с датами
- glob - для поиска файлов по шаблону
- argparse - для обработки аргументов командной строки

Под Windows для воспроизведения звуков используется PowerShell и System.Media.SoundPlayer.
Под Linux для воспроизведения MP3-файлов требуется `mpg123`.

## Установка

1. Клонируйте репозиторий:
```
git clone <repository-url>
cd <repository-directory>
```

2. Установите зависимости:
```
pip install -r requirements.txt
```

3. Для Linux установите `mpg123`:
```
sudo apt-get install mpg123  # Debian/Ubuntu
```

## Использование

### Запуск меню

```
python run_menu.py
```

### Опции командной строки

```
python run_menu.py --help
```

Доступные опции:
- `--no-tts` - отключить озвучку
- `--cache-dir DIR` - указать директорию для кэширования звуков (по умолчанию "/home/aleks/cache_tts")
- `--pre-generate` - предварительно сгенерировать все звуки и выйти
- `--debug` - включить режим отладки с выводом диагностической информации
- `--use-mp3` - использовать MP3 вместо WAV (WAV обычно воспроизводится быстрее)
- `--voice VOICE_ID` - выбрать голос для озвучки (например: ru-RU-Standard-A)
- `--tts-engine {gtts,google_cloud}` - движок для синтеза речи (`gtts` или `google_cloud`)
- `--google-cloud-credentials FILE` - путь к файлу с учетными данными Google Cloud
- `--show-metrics` - показать подробную информацию об использовании Google Cloud API

### Предварительная генерация звуков

Чтобы предварительно сгенерировать все звуки для меню (рекомендуется):

```
python run_menu.py --pre-generate
```

Для генерации озвучки с конкретным голосом:

```
python run_menu.py --pre-generate --voice ru-RU-Standard-B
```

Для генерации озвучки с использованием Google Cloud TTS:

```
python run_menu.py --pre-generate --tts-engine google_cloud --google-cloud-credentials credentials-google-api.json --debug
```

Это создаст все необходимые файлы озвучки в директории `cache_tts`.

## Навигация по меню

- `KEY_UP` - перемещение вверх по меню
- `KEY_DOWN` - перемещение вниз по меню
- `KEY_SELECT` - выбор текущего пункта меню
- `KEY_BACK` - возврат в родительское меню

## Доступные голоса

В системе доступны следующие голоса для озвучки:
- `ru-RU-Standard-A` - Женский голос 1 (по умолчанию)
- `ru-RU-Standard-B` - Мужской голос 1
- `ru-RU-Standard-C` - Женский голос 2
- `ru-RU-Standard-D` - Мужской голос 2
- `ru-RU-Standard-E` - Женский голос 3

Выбор голоса доступен через меню: "Настройки" -> "Выбор голоса".
Выбранный голос сохраняется между запусками программы.

## Кастомизация

### Добавление новых пунктов меню

Структура меню задается в методе `create_menu_structure()` класса `MenuManager`. Для добавления новых пунктов измените соответствующий код в файле `menu/menu_manager.py`.

### Настройка озвучки

Для настройки параметров озвучки измените параметры в конструкторе класса `TTSManager` в файле `menu/tts_manager.py`.

### Добавление новых голосов

Для добавления новых голосов измените метод `get_available_voices()` в классе `SettingsManager` в файле `menu/settings_manager.py`.

# Raspberry Pi Dictaphone

Проект диктофона на Raspberry Pi с текстовой и голосовой навигацией по меню.

## Новые возможности

- Синтез речи с использованием Google Cloud Text-to-Speech API с поддержкой различных голосов
- Поддержка двух движков синтеза речи: gTTS (бесплатно) и Google Cloud TTS (более качественный, требует аккаунта)
- Возможность выбора голоса для озвучки меню
- Кэширование аудиофайлов, созданных Google Cloud TTS API (экономия на повторных запросах)
- Мониторинг использования Google Cloud API и отображение метрик в режиме отладки

## Запуск

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Запуск с gTTS (по умолчанию)

```bash
python run_menu.py
```

### Запуск с Google Cloud TTS

```bash
python run_menu.py --tts-engine google_cloud --google-cloud-credentials credentials-google-api.json --debug
```

### Параметры запуска

- `--no-tts` - запуск без озвучки
- `--debug` - режим отладки с выводом диагностики
- `--cache-dir DIR` - указание директории для кэширования (по умолчанию `/home/aleks/cache_tts`)
- `--use-mp3` - использовать MP3 вместо WAV для воспроизведения
- `--voice VOICE_ID` - идентификатор голоса для озвучки (например, `ru-RU-Standard-A`)
- `--tts-engine {gtts,google_cloud}` - движок для синтеза речи (`gtts` или `google_cloud`)
- `--google-cloud-credentials FILE` - путь к файлу с учетными данными Google Cloud
- `--show-metrics` - показать подробную статистику использования Google Cloud API

## Настройка Google Cloud TTS

1. Создайте проект в Google Cloud и активируйте API для Text-to-Speech
2. Создайте сервисный аккаунт и скачайте ключ в формате JSON
3. Сохраните ключ как `credentials-google-api.json` в корне проекта
4. Файл с ключом автоматически добавлен в `.gitignore` для безопасности

## Доступные голоса

- `ru-RU-Standard-A` - Женский голос 1
- `ru-RU-Standard-B` - Мужской голос 1
- `ru-RU-Standard-C` - Женский голос 2
- `ru-RU-Standard-D` - Мужской голос 2
- `ru-RU-Standard-E` - Женский голос 3

При использовании Google Cloud TTS вы получите доступ к дополнительным голосам, качество которых значительно выше, чем у gTTS.

## Кэширование и экономия ресурсов

Система автоматически кэширует все аудиофайлы, созданные с помощью Google Cloud TTS API. При повторных запросах используются файлы из кэша, что не требует дополнительных расходов. Кэшированные файлы имеют префикс `gc_` и хранятся в директории, указанной в параметре `--cache-dir`.

Google Cloud TTS API предоставляет 1 миллион бесплатных символов в месяц, после чего начинается тарификация. В режиме отладки система показывает текущее использование API и оставшееся количество бесплатных символов.